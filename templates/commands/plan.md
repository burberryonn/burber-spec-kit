---
description: Сформировать план реализации под архитектуру FSD + Vite + React + Tailwind + shadcn/ui.
scripts:
  sh: scripts/bash/setup-plan.sh --json
  ps: scripts/powershell/setup-plan.ps1 -Json
agent_scripts:
  sh: scripts/bash/update-agent-context.sh __AGENT__
  ps: scripts/powershell/update-agent-context.ps1 -AgentType __AGENT__
---

## Пользовательский ввод

```text
$ARGUMENTS
```

Всегда учитывайте пользовательский ввод, даже если он пустой (в этом случае нужно сообщить об ошибке).

---

## Алгоритм

1. **Получите контекст проекта**
   - Выполните `{SCRIPT}` из корня репозитория (только один запуск).
   - Разберите JSON и сохраните абсолютные пути: `FEATURE_SPEC`, `FEATURE_DIR`, `PLAN_TEMPLATE`, `BRANCH`.
   - Если вывод пустой или повреждён — остановитесь с ошибкой.

2. **Загрузите основы**
   - `templates/plan-template.md` — заполнить структуру.
   - `specs/[...]/spec.md` — потребности и пользовательские истории.
   - `.specify/memory/constitution.md` — соблюдение внутренних правил.

3. **Изучите документацию через context7**
   - Выполните последовательность JSON-RPC:
     1. `initialize` (укажите `clientInfo.name = "roo-code"`).
     2. `tools/list` → убедитесь, что доступны `resolve-library-id` и `get-library-docs`.
     3. Для каждой библиотеки (`tailwindcss`, `vite`, `react`, `shadcn/ui`):
        - `tools/call` → `resolve-library-id` с `libraryName`.
        - `tools/call` → `get-library-docs` с полученным ID и указанием интересующей темы (например, `"routing"`, `"styling"`).
   - Вставьте ссылки/версии в раздел “Источники и ссылки” плана.
   - Если доступ отклонён (неверный ключ), зафиксируйте это и попросите пользователя обновить ключ. План продолжайте со ссылкой на проблему.

4. **Соберите технический контекст**
   - Подтвердите стек: Vite + React + Tailwind + shadcn/ui.
   - Убедитесь, что язык реализации — JavaScript. TypeScript подключайте только если в спецификации явно указано требование.
   - Уточните нужные сущности/данные по `spec.md`. Неясности помечайте `NEEDS CLARIFICATION` (максимум 5).

5. **Заполните `plan.md`**
   - Следуйте структуре шаблона:
     - Резюме, технический контекст, проверка конституции.
     - FSD-структура директорий.
     - Фазы: Research → Design → Tasks → Implementation → Testing.
     - Контроль сложности, план тестирования (в конце), источники.
   - Все пути указывайте абсолютные (`src/features/...`).
   - Для каждой фазы зафиксируйте конкретные действия и ожидаемые артефакты.
   - Обязательно отметьте, что тесты запускаются только после завершения всех пользовательских историй.

6. **Синхронизация агентов**
   - После заполнения плана вызовите `{AGENT_SCRIPT}` из шаблона команд (bash или PowerShell) с `__AGENT__ = roo`.
   - Убедитесь, что контекст Roo Code обновлён (новые технологии, директории).

7. **Валидация плана**
   - Проверьте, что нет `NEEDS CLARIFICATION` без адресата.
   - Убедитесь, что все решения подкреплены ссылками на context7 или исследования.
   - План должен быть выполним без изменения глобальных требований конституции.

8. **Отчёт**
   - Сообщите:
     - Путь к `plan.md`.
     - Созданные/обновлённые документы (research.md, data-model.md и т.д., если затронуты).
     - Список ссылок на документацию из context7.
     - Нерешённые вопросы и риски (если остались).

---

## Правила

- Русский — основной язык всех документов.  
- Любая новая зависимость должна быть подтверждена выпиской из context7.  
- Не добавляйте TypeScript, если пользователь не потребовал этого в спецификации.  
- Тесты описываются только в финальной фазе.  
- Все отклонения от FSD фиксируйте в разделе “Контроль сложности и рисков”.  
- Не генерируйте чеклисты внутри `plan.md` — для этого есть отдельная команда.

При возникновении ошибок или пропуска обязательного шага останавливайте выполнение и подробно описывайте проблему пользователю.
