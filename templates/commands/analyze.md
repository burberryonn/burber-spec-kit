---
description: Выполнить кросс-анализ `spec.md`, `plan.md`, `tasks.md` и конституции после генерации задач.
scripts:
  sh: scripts/bash/check-prerequisites.sh --json --require-tasks --include-tasks
  ps: scripts/powershell/check-prerequisites.ps1 -Json -RequireTasks -IncludeTasks
---

## Пользовательский ввод

```text
$ARGUMENTS
```

---

## Цель

Проверить соответствие документов Spec→Plan→Tasks требованиям конституции (FSD + Vite + React + TypeScript + Mantine) и выявить расхождения до начала `/speckit.implement`.

---

## Шаги

1. **Получить контекст**:
   - Запусти `{SCRIPT}` и получи `FEATURE_DIR`, `PLAN_PATH`, `TASKS_PATH`.
   - Убедись, что существует `spec.md`, `plan.md`, `tasks.md`. При отсутствии — остановись.
   - Найди конституцию: `memory/constitution.md`.

2. **Загрузить документы**:
   - `spec.md`: пользовательские истории, требования, FSD-карта, критерии успеха.
   - `plan.md`: фазы, технический контекст (Mantine theme, TypeScript strict, CI), структура FSD.
   - `tasks.md`: фазы, задачи, `[P]`, привязка к историям, DoD.
   - `constitution.md`: инвариантные правила (нет Tailwind, TypeScript strict, Mantine-only UI).

3. **Сверка**:
   - Каждая история из `spec.md` имеет фазу и задачи в `tasks.md` (с указанием путей слоёв FSD).
   - Фазы и зависимости `plan.md` отражены в `tasks.md`.
   - Проверить, что задачи используют утверждённый стек (TypeScript, Mantine, i18next, Zustand/RTK) и не вводят запрещённые зависимости.
   - Убедиться, что тесты и CI-задачи запланированы в финальной фазе (Vitest + lint + typecheck + build).
   - Проверить наличие шагов по документации (`docs/architecture.md`, ADR, changelog).
   - Сопоставить с конституцией: а11y, отсутствие Tailwind, Conventional Commits/CI требования.

4. **Сформировать отчёт**:
   - **Статус**: `OK` или `Нужно исправить`.
   - **Обнаруженные несоответствия**: указать файл, раздел, суть проблемы.
   - **Рекомендации**: какие команды/документы нужно обновить (например, повторить `/speckit.plan` или /tasks).
   - **Риски**: потенциальные нарушения или незакрытые `NEEDS CLARIFICATION`.
   - Отчёт текстовый, без изменения файлов.

---

## Формат отчёта

```
Статус: Нужно исправить

- plan.md → tasks.md: отсутствует фаза для US2 (нужно доработать план).
- tasks.md: найдена задача “Добавить Tailwind” — нарушает конституцию (Mantine only).
- tasks.md: тестовые задачи находятся в фазе US1, а не в финальной Verify.

Рекомендации:
1. Обновить plan.md (Phase 4 для US2).
2. Перегенерировать tasks.md после исправления плана.
3. Перенести тесты в финальную фазу, заменить Tailwind на Mantine theme.

Риски:
- Возможное нарушение CI (нет задачи на `tsc --noEmit`).
```

---

## Нельзя

- Править `spec.md`, `plan.md`, `tasks.md` — только анализ.
- Игнорировать нарушения конституции или стековых правил.
- Завершать команду без явного отчёта даже при отсутствии проблем.
