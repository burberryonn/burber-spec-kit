---
description: Выполнить кросс-анализ `spec.md`, `plan.md`, `tasks.md` и конституции после генерации задач.
scripts:
  sh: scripts/bash/check-prerequisites.sh --json --require-tasks --include-tasks
  ps: scripts/powershell/check-prerequisites.ps1 -Json -RequireTasks -IncludeTasks
---

## Пользовательский ввод

```text
$ARGUMENTS
```

---

## Цель

Выявить противоречия между спецификацией, планом и списком задач, не изменяя файлы. Результат — отчёт о несоответствиях и предложения по корректировкам.

---

## Шаги

1. **Получить контекст**:
   - Запусти `{SCRIPT}` из корня, получи `FEATURE_DIR`, `PLAN_PATH`, `TASKS_PATH`.
   - Проверь наличие `spec.md`, `plan.md`, `tasks.md`. При отсутствии — остановись.
   - Найди конституцию: `memory/constitution.md`.

2. **Загрузить артефакты**:
   - `spec.md` — истории, функциональные требования, критерии.
   - `plan.md` — технический контекст, структура FSD, фазы.
   - `tasks.md` — все задачи, фазы, `[P]`, привязка к историям.
   - `constitution.md` — принципы и ограничения.

3. **Сверить документы**:
   - Каждая история из `spec.md` должна быть отражена в `tasks.md` (отдельная фаза, задачи, критерии завершения).
   - Фазы и зависимости из `plan.md` совпадают с `tasks.md`.
   - Проверить, что задачи не нарушают границы FSD (импорты, структура).
   - Тесты присутствуют только в финальной фазе, как указано в плановых правилах.
   - Убедиться, что задачи покрывают все требования (функциональные и нефункциональные).
   - Проверить соблюдение конституции (например, отсутствие TypeScript без разрешения, порядок внедрения тестов).

4. **Подготовить отчёт**:
   - Структура:
     1. **Общий статус** (`OK` или `Есть проблемы`).
     2. **Несоответствия** — таблица или маркированный список с указанием файла и строки/раздела.
     3. **Рекомендации** — какие команды/шаги нужно повторить (`/speckit.specify`, `/speckit.plan`, `/speckit.tasks`) и что исправить вручную.
     4. **Риски** — потенциальные нарушения конституции, не закрытые вопросы.
   - Не вноси изменений в файлы, только описывай находки.

---

## Отчёт

Пример формата:

```
Статус: Требуются правки

- spec.md → plan.md: История US2 отсутствует в plan.md (раздел Фаза 4).
- plan.md → tasks.md: В Фазе 2 нет задачи по настройке Tailwind (указано в плане).
- tasks.md: Найдены тестовые задачи в фазе US1 (нарушение правила «тесты в конце»).

Рекомендации:
1. Обновить план (добавить шаги для US2).
2. Перегенерировать tasks.md после исправления плана.
3. Перенести тестовые задачи в финальную фазу.

Риски:
- Возможное нарушение конституции §3 — запуск тестов до завершения функционала.
```

---

## Нельзя

- Править `spec.md`, `plan.md`, `tasks.md` внутри этой команды.
- Игнорировать нарушения конституции или ссылки на context7.
- Завершать команду без отчёта, даже если несоответствий нет (нужно явно указать, что всё корректно).
