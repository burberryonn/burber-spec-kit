---
description: Сформировать tasks.md с зависимостями для FSD + Vite + React + Tailwind + shadcn/ui.
scripts:
  sh: scripts/bash/check-prerequisites.sh --json
  ps: scripts/powershell/check-prerequisites.ps1 -Json
---

## Пользовательский ввод

```text
$ARGUMENTS
```

---

## Подготовка

1. Выполните `{SCRIPT}` из корня репозитория. Разберите JSON:
   - `FEATURE_DIR`, `PLAN_PATH`, `SPEC_PATH`, `AVAILABLE_DOCS`.
   - Проверяйте, что `plan.md` и `spec.md` существуют. Если чего-то нет — остановитесь с ошибкой.
2. Загрузите артефакты:
   - `plan.md` — базовый стек и структура FSD.
   - `spec.md` — пользовательские истории и приоритеты (P1...).
   - `research.md`, `data-model.md`, `contracts/`, `quickstart.md` — при наличии.
   - `.specify/templates/tasks-template.md` — структура итогового файла.
3. Убедитесь, что `plan.md` содержит ссылки на context7. Если отсутствуют — предупредите пользователя и продолжайте, но пометьте это в отчёте.

---

## Генерация задач

1. **Извлеките структуру FSD**
   - Определите, какие слои затрагиваются (entities/features/widgets/pages/processes/app/shared).
   - Каждая задача должна ссылаться на конкретный путь (например, `src/features/cart/ui/AddButton.jsx`).

2. **Организуйте по фазам**
   - Фаза 1 — инициализация проекта.
   - Фаза 2 — базовая инфраструктура, общая для всех историй.
   - Фазы 3+ — одна фаза на каждую пользовательскую историю (в порядке P1 → P2 → ...).
   - Финальная фаза — “Завершение и тестирование” (автотесты/ручные проверки только здесь).

3. **Правила тестирования**
   - Не добавляйте тестовые задачи в фазах историй.
   - В финальной фазе добавьте задачи на тесты только если они упомянуты в спецификации или в `plan.md`.
   - Фиксируйте, что тесты выполняются после завершения всех историй.

4. **Параллельность**
   - Помечайте `[P]` только если задачи не затрагивают одни и те же файлы.
   - Пользовательские истории должны оставаться независимыми: каждая фаза истории должна быть реализуема и проверяема отдельным агентом.

5. **Нумерация**
   - Пронумеруйте задачи последовательно: `T001`, `T002`, …  
   - Для каждой задачи укажите `[Story]` (`US1`, `US2`, ...).

6. **Зависимости**
   - Сформируйте раздел с зависимостями между фазами и историями.
   - Отдельно приведите примеры параллельных запусков (какие задачи можно исполнять одновременно).

7. **Контроль отклонений**
   - Если требуется TypeScript или иной стек, а план молчит — спросите пользователя или отметьте `NEEDS CLARIFICATION`.
   - Любое отличие от FSD фиксируйте в заметках.

---

## Создание файла

1. Используйте структуру `templates/tasks-template.md`.
2. Подставьте:
   - Название фичи.
   - Заполненные списки задач по фазам.
   - Раздел “Зависимости и параллельность”.
   - Стратегию поставки (MVP → инкременты → финальная фаза).
3. Убедитесь, что текст на русском, термины FSD/стека указаны корректно.
4. Сохраните файл в `FEATURE_DIR/tasks.md`.

---

## Отчёт

После генерации сообщите:

- Путь к `tasks.md`.
- Количество задач всего и по каждой пользовательской истории.
- Есть ли незакрытые `NEEDS CLARIFICATION`.
- Напоминание, что тесты выполняются на финальной фазе.
- Любые проблемы с доступом к context7 (если были).

---

## Ошибки

Останавливайтесь с ошибкой, если:

- Отсутствует `plan.md` или `spec.md`.
- Нет пользовательских историй с приоритетами.
- План не соответствует FSD и нет объяснения.
- Невозможно определить структуру директорий.
